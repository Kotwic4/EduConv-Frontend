<div
    [ngClass]="['hidden-layer__container', 'hidden-layer__container--type-' + layerType, collapsed && layer.haveNeurons() ? 'hidden-layer__container--collapsed' : '']"
    (click)="layer.haveNeurons() && toggleCollapsed()"
>
    <span class="hidden-layer__index">{{ index+1 }}.</span>

    <div
        class="hidden-layer__tools"
        (click)="$event.stopPropagation()"
    >
        <div
            class="hidden-layer__type"
            [matTooltip]="types_names[layerType]"
            matTooltipPosition="above"
        >
            <mat-form-field
                *ngIf="!readonly"
            >
                <mat-select [(value)]="layerType" (change)="onTypeChange()">
                    <mat-option
                        *ngFor="let value of types_values; let i = index;"
                        [value]="value"
                    >{{ types_names[i] }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div
                *ngIf="readonly"
                class="hidden-layer__type-readonly-name"
            >
                {{ types_names[layerType] }}
            </div>
        </div>

        <div
            *ngIf="!readonly"
            class="hidden-layer__settings"
            matTooltip="Layer settings"
            matTooltipPosition="above"
        >
            <i
                class="fa fa-cog"
                [ngbPopover]="getArgsComponent(types_names[layerType])"
                [triggers]="readonly ? 'mouseenter:mouseleave' : 'click'"
                #p="ngbPopover"
                container="body"
                placement="bottom"
            ></i>
        </div>
    </div>

    <ng-container *ngIf="layer.haveNeurons()">
        <app-neurons-counter
            *ngIf="!readonly"
            [value]="layer.getNeurons()"
            (onChange)="onAmountChange($event)"
        ></app-neurons-counter>
        <ng-container *ngIf="!collapsed">
            <app-neurone
                *ngFor="let neurone of range(layer.getNeurons()); let i = index;"
                [index]="i"
                [image]="images ? images[i] : null"
            ></app-neurone>
        </ng-container>
        <div *ngIf="readonly && collapsed" class="hidden-layer__neurons-amount">
            <span class="hidden-layer__neurons-amount-digits">{{ layer.getNeurons() | number }}</span> neurons
        </div>
    </ng-container>
    <div *ngIf="!layer.haveNeurons()" class="hidden-layer__no-neurons-info">
        No neurons
    </div>
</div>

<ng-template #Conv2D>
    <app-conv2d-layer [index]="index" [layer]="layer" [readonly]="readonly" (onSave)="onSave($event)"
                      (onCancel)="onCancel($event)" (onDelete)="onDelete($event)"></app-conv2d-layer>
</ng-template>

<ng-template #Dense>
    <app-dense-layer [index]="index" [layer]="layer" [readonly]="readonly" (onSave)="onSave($event)"
                     (onCancel)="onCancel($event)" (onDelete)="onDelete($event)"></app-dense-layer>
</ng-template>

<ng-template #Dropout>
    <app-dropout-layer [index]="index" [layer]="layer" [readonly]="readonly" (onSave)="onSave($event)"
                       (onCancel)="onCancel($event)" (onDelete)="onDelete($event)"></app-dropout-layer>
</ng-template>

<ng-template #Flatten>
    <app-flatten-layer [index]="index" [layer]="layer" [readonly]="readonly" (onSave)="onSave($event)"
                       (onCancel)="onCancel($event)" (onDelete)="onDelete($event)"></app-flatten-layer>
</ng-template>

<ng-template #MaxPooling2D>
    <app-max-pooling2d-layer [index]="index" [layer]="layer" [readonly]="readonly" (onSave)="onSave($event)"
                             (onCancel)="onCancel($event)" (onDelete)="onDelete($event)"></app-max-pooling2d-layer>
</ng-template>
